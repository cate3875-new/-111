<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>èŠ±æ —é¼ åº¦å‡è½‰ç›¤-å°ˆå±¬ç‰ˆ</title>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Dela+Gothic+One&family=Kosugi+Maru&family=Noto+Sans+TC:wght@900&display=swap');
  
  :root { 
      --bg:#fff0f5; 
      --pink:#ff91a4; 
      --green:#80e8d1; 
      --yellow:#fffacd; 
      --brown:#5d4037;
  }

  /* --- é—œéµä¿®æ­£ï¼šå…¨åŸŸè¨­å®šï¼Œé˜²æ­¢è·‘ç‰ˆ --- */
  * { box-sizing: border-box; }

  body {
    margin:0; padding:10px;
    background-color:var(--bg);
    background-image:
      url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Ctext x='10' y='30' font-size='22' fill-opacity='0.25'%3EğŸ°%3C/text%3E%3Ctext x='60' y='50' font-size='22' fill-opacity='0.25'%3EğŸ©%3C/text%3E%3Ctext x='30' y='90' font-size='22' fill-opacity='0.25'%3EğŸ¹%3C/text%3E%3Ctext x='90' y='20' font-size='22' fill-opacity='0.25'%3EğŸ¦%3C/text%3E%3C/svg%3E"),
      url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200' viewBox='0 0 200 200'%3E%3Ctext x='30' y='60' font-size='40' fill-opacity='0.15'%3EğŸ¡%3C/text%3E%3Ctext x='120' y='150' font-size='40' fill-opacity='0.15'%3EğŸ–ï¸%3C/text%3E%3Ctext x='150' y='50' font-size='30' fill-opacity='0.15'%3EğŸŒŠ%3C/text%3E%3C/svg%3E");
    background-size:120px 120px, 200px 200px; background-position:0 0, 60px 60px;
    font-family:'Kosugi Maru', sans-serif; color:var(--brown);
    display:flex; justify-content:center; align-items:center; min-height:100vh;
    overflow-x: hidden; /* é˜²æ­¢å·¦å³æ»‘å‹• */
  }

  .container { 
      background:rgba(255,255,255,0.95); 
      width: 100%; max-width: 450px; 
      padding: 20px 15px; 
      border-radius:25px; 
      border:4px dashed var(--pink); 
      box-shadow:0 10px 0 var(--yellow); 
      text-align:center; 
      position: relative; margin: auto;
  }
  
  /* æ¨™é¡Œå­—é«”è‡ªå‹•ç¸®æ”¾ */
  .title-in {
    font-family: 'Noto Sans TC', sans-serif; font-weight: 900;
    font-size: clamp(1.8rem, 8vw, 3.0rem); 
    margin:10px 0 20px 0; color:var(--pink); 
    background:rgba(255,255,255,0.5);
    border:2px dashed transparent; border-radius: 15px;
    text-align:center; width:100%; outline:none;
    position: relative; z-index: 100; padding: 5px 0;
  }
  .title-in:focus { border-color: var(--green); background:#fff; }

  .panel { background:#f8ffff; border:3px dotted var(--green); border-radius:20px; padding:15px; margin-bottom:20px; }
  .inputs { display:flex; gap:5px; margin-bottom:10px; }
  input { padding:8px; border:2px solid var(--pink); border-radius:12px; font-family:'Kosugi Maru'; font-size:1rem; outline:none; }
  #tIn { flex: 3; min-width: 0; }
  
  .btn-add { background:var(--green); border:none; color:#fff; width:42px; border-radius:12px; font-size:1.5rem; cursor:pointer; box-shadow:0 3px 0 #4db6ac; flex-shrink: 0;}
  .btn-add:active { transform:translateY(3px); box-shadow:none; }
  .tags { display:flex; flex-wrap:wrap; gap:5px; justify-content:center; margin-top:10px; max-height:100px; overflow-y:auto; }
  .tag { background:var(--yellow); padding:5px 10px; border-radius:15px; font-size:0.9rem; border:2px solid var(--pink); display:flex; align-items:center; gap:5px; }
  
  /* è½‰ç›¤è‡ªé©æ‡‰ */
  .wheel-box { 
    position:relative; width: 100%; max-width: 280px; 
    aspect-ratio: 1 / 1; height: auto; margin: 30px auto 20px auto; 
  }
  canvas { width:100%; height:100%; border-radius:50%; box-shadow:0 0 0 8px #fff, 0 0 0 12px var(--pink); }
  
  .pointer-wrapper {
      position:absolute; top:-55px; left:50%; transform:translateX(-50%); 
      z-index:10; text-align: center;
      filter:drop-shadow(0 3px 0 rgba(0,0,0,0.2));
      animation: float 2s infinite ease-in-out;
  }
  .chipmunk { font-size: 4rem; line-height: 1; display: block; margin-bottom: -25px; position: relative; z-index: 2; }
  .acorn { font-size: 2.5rem; display: block; transform: rotate(180deg); position: relative; z-index: 1; }
  @keyframes float { 0%,100% {transform:translate(-50%, 0);} 50% {transform:translate(-50%, -8px);} }

  .btn-go {
    background:var(--pink); color:#fff; border:none; padding:15px 10px; font-size:1.5rem; border-radius:50px;
    font-family:'Dela Gothic One', cursive; cursor:pointer; width:100%;
    box-shadow:inset 0 -5px 0 rgba(0,0,0,0.1), 0 6px 0 #d65c7a;
    transition: all 0.2s; white-space: nowrap;
  }
  .btn-go:active { transform:translateY(6px); box-shadow:inset 0 -2px 0 rgba(0,0,0,0.1); }
  .btn-go:disabled { background:#ccc; cursor:not-allowed; box-shadow:none; transform:translateY(2px); color:#888; }

  .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; justify-content:center; align-items:center; z-index:999; backdrop-filter:blur(3px); }
  .card { background:#fff; padding:30px; border-radius:30px; border:5px solid var(--pink); text-align:center; width:85%; max-width: 400px; animation:pop 0.3s ease; }
  .res-txt { font-size:2.5rem; font-weight:bold; color:var(--pink); margin:20px 0; word-break:break-all; }
  .btns { display:flex; gap:10px; justify-content:center; margin-top:20px; flex-wrap: wrap;}
  .btn-sm { border:none; padding:10px 20px; border-radius:20px; font-size:1rem; cursor:pointer; font-weight:bold; white-space: nowrap;}
  .b-close { background:#ddd; color:#555; }
  .b-down { background:var(--green); color:#fff; box-shadow:0 3px 0 #4db6ac; }
  @keyframes pop { from{transform:scale(0.5);opacity:0} to{transform:scale(1);opacity:1} }

  /* æ‰‹æ©Ÿç‰ˆå¾®èª¿ */
  @media(max-width: 360px) {
    .container { padding: 15px 10px; }
    .pointer-wrapper { top: -45px; }
    .chipmunk { font-size: 3.5rem; }
    .btn-go { font-size: 1.2rem; }
  }
</style>
</head>
<body>

<div class="container">
  <input type="text" class="title-in" value="LUCKY VACATION!" onclick="this.select()">
  <div class="panel">
    <div style="background:var(--pink); color:#fff; display:inline-block; padding:2px 10px; border-radius:10px; font-size:0.8rem; margin-bottom:5px;" id="countLbl">ç¸½æ•¸: 5</div>
    <div class="inputs">
      <input type="text" id="tIn" placeholder="è¼¸å…¥é …ç›®">
      <input type="number" id="nIn" value="1" min="1" style="flex:1; text-align:center; max-width: 60px;">
      <button class="btn-add" onclick="addIt()">ï¼‹</button>
    </div>
    <div class="tags" id="list"></div>
  </div>
  <div class="wheel-box">
    <div class="pointer-wrapper">
        <span class="chipmunk">ğŸ¿ï¸</span>
        <span class="acorn">ğŸŒ°</span>
    </div>
    <canvas id="cvs" width="560" height="560"></canvas>
  </div>
  <button class="btn-go" id="goBtn" onclick="spin()">GO! é–‹å§‹è½‰å‹•!</button>
</div>

<div class="modal" id="mod">
  <div class="card" id="shot">
    <h2 style="color:var(--green); margin:0; font-family:'Dela Gothic One'">CONGRATS!</h2>
    <div class="res-txt" id="res">?</div>
    
    <div style="font-size:0.8rem; color:#aaa;">@å“ºå“ºæ„›å°é›ªäºº</div>

    <div class="btns" data-html2canvas-ignore="true">
      <button class="btn-sm b-close" onclick="closeM()">é—œé–‰</button>
      <button class="btn-sm b-down" onclick="downImg()">ä¸‹è¼‰åœ–ç‰‡ ğŸ“¸</button>
    </div>
  </div>
</div>

<script>
  const cvs = document.getElementById('cvs');
  const ctx = cvs.getContext('2d');
  const colors = ['#FF91A4', '#FFB7C5', '#80E8D1', '#A7F0E0', '#FFFACD', '#FFE4B5', '#C7CEFF'];
  
  let items = ['çœ‹æµ· ğŸŒŠ', 'åƒå†° ğŸ§', 'æ‘©å¤©è¼ª ğŸ¡', 'ç”œé» ğŸ°', 'æ”¾ç©º ğŸ˜´'];
  
  let startAngle = 0;
  let arc = Math.PI * 2 / items.length;
  let spinTime = 0;
  let spinTimeTotal = 0;
  let startSpeed = 0;
  let isSpin = false;
  let timer = null;

  window.onload = function() {
    if(items.length === 0) {
        items = ['çœ‹æµ· ğŸŒŠ', 'åƒå†° ğŸ§', 'æ‘©å¤©è¼ª ğŸ¡', 'ç”œé» ğŸ°', 'æ”¾ç©º ğŸ˜´'];
    }
    updUI();
    draw();
  };

  function addIt() {
    if(isSpin) return;
    const txt = document.getElementById('tIn').value.trim();
    const num = parseInt(document.getElementById('nIn').value) || 1;
    if(txt && num > 0) {
      for(let i=0; i<num; i++) items.push(txt);
      document.getElementById('tIn').value='';
      document.getElementById('nIn').value='1';
      updUI(); draw();
    }
  }

  function rem(n) {
    if(isSpin) return;
    const idx = items.indexOf(n);
    if(idx > -1) items.splice(idx, 1);
    updUI(); draw();
  }

  function updUI() {
    const l = document.getElementById('list');
    document.getElementById('countLbl').innerText = `ç¸½æ•¸: ${items.length}`;
    l.innerHTML = '';
    const cnt = {};
    items.forEach(i => cnt[i] = (cnt[i]||0)+1);
    for(let [k,v] of Object.entries(cnt)) {
      l.innerHTML += `<div class="tag">${k} <small>x${v}</small> <span style="color:#ff5252;cursor:pointer;font-weight:bold" onclick="rem('${k}')">Ã—</span></div>`;
    }
    arc = Math.PI * 2 / items.length;
  }

  function draw() {
    if(!ctx) return;
    const outR = 270, textR = 180, cx = 280, cy = 280;
    ctx.clearRect(0,0,560,560);
    if(items.length===0) {
        ctx.beginPath(); ctx.arc(cx,cy,outR,0,Math.PI*2); 
        ctx.strokeStyle="#ccc"; ctx.stroke();
        ctx.font = "20px sans-serif"; ctx.fillStyle="#aaa"; ctx.fillText("è«‹æ–°å¢é …ç›®", cx-50, cy);
        return;
    }

    for(let i=0; i<items.length; i++) {
      const a = startAngle + i * arc;
      ctx.fillStyle = colors[i%colors.length];
      ctx.beginPath(); ctx.moveTo(cx,cy);
      ctx.arc(cx,cy,outR, a, a+arc, false);
      ctx.lineTo(cx,cy); ctx.fill();
      ctx.strokeStyle="#fff"; ctx.lineWidth=5; ctx.stroke();

      ctx.save();
      ctx.translate(cx + Math.cos(a + arc/2)*textR, cy + Math.sin(a + arc/2)*textR);
      ctx.rotate(a + arc/2 + Math.PI/2);
      const txt = items[i];
      let fSize = items.length>10 ? 26 : 36;
      ctx.font = `bold ${fSize}px Kosugi Maru`;
      ctx.fillStyle = "#5d4037"; ctx.textAlign = "center";
      ctx.fillText(txt.length>5 ? txt.substring(0,5)+'..' : txt, 0, 10);
      ctx.restore();
    }
  }

  function spin() {
    if(isSpin || items.length<2) { if(items.length<2) alert("è‡³å°‘è¦å…©å€‹é …ç›®!"); return; }
    isSpin = true;
    document.getElementById('goBtn').disabled = true;
    document.getElementById('goBtn').innerText = "è½‰å‹•ä¸­...";
    
    startSpeed = Math.random() * 20 + 40; 
    spinTime = 0;
    spinTimeTotal = 4000; 
    rotate();
  }

  function rotate() {
    spinTime += 30;
    if(spinTime >= spinTimeTotal) {
      stop(); return;
    }
    const angleChange = (startSpeed * (spinTimeTotal - spinTime) / spinTimeTotal);
    startAngle += (angleChange * Math.PI / 180);
    draw();
    timer = setTimeout(rotate, 30);
  }

  function stop() {
    clearTimeout(timer);
    const deg = startAngle * 180 / Math.PI + 90;
    const idx = Math.floor((360 - deg % 360) / (360 / items.length));
    document.getElementById('res').innerText = items[idx];
    document.getElementById('mod').style.display = 'flex';
    isSpin = false;
    document.getElementById('goBtn').disabled = false;
    document.getElementById('goBtn').innerText = "GO! å†è½‰ä¸€æ¬¡!";
  }

  function closeM() { document.getElementById('mod').style.display = 'none'; }
  
  function downImg() {
    const el = document.getElementById("shot");
    html2canvas(el, { backgroundColor: '#ffffff', scale: 2 }).then(orgCanvas => {
      const size = Math.max(orgCanvas.width, orgCanvas.height);
      const sqCanvas = document.createElement('canvas');
      sqCanvas.width = size;
      sqCanvas.height = size;
      const sqCtx = sqCanvas.getContext('2d');
      sqCtx.fillStyle = '#ffffff';
      sqCtx.fillRect(0, 0, size, size);
      sqCtx.drawImage(orgCanvas, (size - orgCanvas.width) / 2, (size - orgCanvas.height) / 2);
      const a = document.createElement('a');
      a.download = 'My_Lucky_Square.png';
      a.href = sqCanvas.toDataURL("image/png");
      a.click();
    });
  }
</script>
</body>
</html>
